<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Impostor Game</title>
    <script src="https://unpkg.com/playroomkit/multiplayer.umd.js"></script>
    <style>
        body { background-color: #010a13; color: #f0e6d2; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #game-area { background: rgba(10, 20, 40, 0.9); border: 2px solid #785a28; padding: 30px; border-radius: 8px; text-align: center; width: 90%; max-width: 500px; }
        button { background-color: #1e2328; color: #cdbe91; border: 1px solid #785a28; padding: 12px 24px; margin: 10px; cursor: pointer; font-weight: bold; text-transform: uppercase; border-radius: 4px; }
        button:hover { background-color: #252c32; border-color: #c89b3c; }
        .timer { font-size: 3rem; color: #c8aa6e; margin: 20px 0; }
        img { width: 120px; border-radius: 50%; border: 3px solid #785a28; margin-top: 15px; }
        .role-box { padding: 20px; border: 1px dashed #785a28; margin: 20px 0; }
    </style>
</head>
<body>

<div id="game-area">
    <h1 id="status">Loading Hextech...</h1>
    <div id="content"></div>
    
    <div id="chat-container" style="margin-top: 20px; border-top: 1px solid #785a28; padding-top: 10px;">
        <div id="chat-box" style="height: 100px; overflow-y: auto; text-align: left; font-size: 0.8rem; margin-bottom: 5px; background: rgba(0,0,0,0.3); padding: 5px;"></div>
        <input type="text" id="chat-input" placeholder="Type answer..." style="width: 70%; background: #1e2328; color: #cdbe91; border: 1px solid #785a28;">
        <button onclick="sendChat()" style="padding: 5px; margin: 0;">Send</button>
    </div>
</div>

<script>
const { insertCoin, onPlayerJoin, myPlayer, isHost, setState, getState, getPlayers, onChatMessage } = Playroom;

const CHAMPION_POOL = [
    { name: "Aatrox", region: "Runeterra", gender: "Male", weapon: "Greatsword", range: "Melee" },
    { name: "Ahri", region: "Ionia", gender: "Female", weapon: "Magic Orb", range: "Ranged" },
    { name: "Akali", region: "Ionia", gender: "Female", weapon: "Kama/Kunai", range: "Melee" },
    { name: "Akshan", region: "Shurima", gender: "Male", weapon: "Grappling Hook Gun", range: "Ranged" },
    { name: "Alistar", region: "Runeterra", gender: "Male", weapon: "Horns/Fists", range: "Melee" },
    { name: "Amumu", region: "Shurima", gender: "Male", weapon: "Bandages", range: "Melee" },
    { name: "Anivia", region: "Freljord", gender: "Female", weapon: "Ice Magic", range: "Ranged" },
    { name: "Annie", region: "Noxus", gender: "Female", weapon: "Fire Magic", range: "Ranged" },
    { name: "Aphelios", region: "Targon", gender: "Male", weapon: "Moonstone Guns", range: "Ranged" },
    { name: "Ashe", region: "Freljord", gender: "Female", weapon: "Ice Bow", range: "Ranged" },
    { name: "Aurelion Sol", region: "Targon", gender: "Male", weapon: "Star Magic", range: "Ranged" },
    { name: "Azir", region: "Shurima", gender: "Male", weapon: "Staff", range: "Ranged" },
    { name: "Bard", region: "Runeterra", gender: "Male", weapon: "Meeps/Flute", range: "Ranged" },
    { name: "Bel'Veth", region: "Void", gender: "Female", weapon: "Fin Slaps", range: "Melee" },
    { name: "Blitzcrank", region: "Zaun", gender: "Male", weapon: "Rocket Grab", range: "Melee" },
    { name: "Brand", region: "Runeterra", gender: "Male", weapon: "Fire", range: "Ranged" },
    { name: "Braum", region: "Freljord", gender: "Male", weapon: "Giant Shield", range: "Melee" },
    { name: "Briar", region: "Noxus", gender: "Female", weapon: "Fangs/Pillory", range: "Melee" },
    { name: "Caitlyn", region: "Piltover", gender: "Female", weapon: "Sniper Rifle", range: "Ranged" },
    { name: "Camille", region: "Piltover", gender: "Female", weapon: "Leg Blades", range: "Melee" },
    { name: "Cassiopeia", region: "Noxus", gender: "Female", weapon: "Poison/Fangs", range: "Ranged" },
    { name: "Cho'Gath", region: "Void", gender: "Male", weapon: "Claws/Spikes", range: "Melee" },
    { name: "Corki", region: "Bandle City", gender: "Male", weapon: "Airplane/Bombs", range: "Ranged" },
    { name: "Darius", region: "Noxus", gender: "Male", weapon: "Battleaxe", range: "Melee" },
    { name: "Diana", region: "Targon", gender: "Female", weapon: "Crescent Blade", range: "Melee" },
    { name: "Dr. Mundo", region: "Zaun", gender: "Male", weapon: "Cleaver", range: "Melee" },
    { name: "Draven", region: "Noxus", gender: "Male", weapon: "Spinning Axes", range: "Ranged" },
    { name: "Ekko", region: "Zaun", gender: "Male", weapon: "Time Bat", range: "Melee" },
    { name: "Elise", region: "Shadow Isles", gender: "Female", weapon: "Spider Legs", range: "Ranged" },
    { name: "Evelynn", region: "Runeterra", gender: "Female", weapon: "Lashers", range: "Melee" },
    { name: "Ezreal", region: "Piltover", gender: "Male", weapon: "Magic Gauntlet", range: "Ranged" },
    { name: "Fiddlesticks", region: "Runeterra", gender: "Male", weapon: "Scythe", range: "Melee" },
    { name: "Fiora", region: "Demacia", gender: "Female", weapon: "Rapier", range: "Melee" },
    { name: "Fizz", region: "Bilgewater", gender: "Male", weapon: "Trident", range: "Melee" },
    { name: "Galio", region: "Demacia", gender: "Male", weapon: "Stone Wings", range: "Melee" },
    { name: "Gangplank", region: "Bilgewater", gender: "Male", weapon: "Cutlass/Pistol", range: "Melee" },
    { name: "Garen", region: "Demacia", gender: "Male", weapon: "Greatsword", range: "Melee" },
    { name: "Gnar", region: "Freljord", gender: "Male", weapon: "Boomerang", range: "Ranged" },
    { name: "Gragas", region: "Freljord", gender: "Male", weapon: "Cask", range: "Melee" },
    { name: "Graves", region: "Bilgewater", gender: "Male", weapon: "Shotgun", range: "Ranged" },
    { name: "Gwen", region: "Shadow Isles", gender: "Female", weapon: "Giant Scissors", range: "Melee" },
    { name: "Hecarim", region: "Shadow Isles", gender: "Male", weapon: "Glaive", range: "Melee" },
    { name: "Heimerdinger", region: "Piltover", gender: "Male", weapon: "Turrets", range: "Ranged" },
    { name: "Illaoi", region: "Bilgewater", gender: "Female", weapon: "Idol", range: "Melee" },
    { name: "Irelia", region: "Ionia", gender: "Female", weapon: "Dancing Blades", range: "Melee" },
    { name: "Ivern", region: "Ionia", gender: "Male", weapon: "Nature Magic", range: "Ranged" },
    { name: "Janna", region: "Zaun", gender: "Female", weapon: "Staff", range: "Ranged" },
    { name: "Jarvan IV", region: "Demacia", gender: "Male", weapon: "Lance", range: "Melee" },
    { name: "Jax", region: "Runeterra", gender: "Male", weapon: "Lamp Post", range: "Melee" },
    { name: "Jayce", region: "Piltover", gender: "Male", weapon: "Hammer/Cannon", range: "Melee" },
    { name: "Jhin", region: "Ionia", gender: "Male", weapon: "Sniper Rifle", range: "Ranged" },
    { name: "Jinx", region: "Zaun", gender: "Female", weapon: "Minigun/Rocket Launcher", range: "Ranged" },
    { name: "K'Sante", region: "Shurima", gender: "Male", weapon: "Ntofos", range: "Melee" },
    { name: "Kai'Sa", region: "Void", gender: "Female", weapon: "Void Pods", range: "Ranged" },
    { name: "Kalista", region: "Shadow Isles", gender: "Female", weapon: "Spears", range: "Ranged" },
    { name: "Karma", region: "Ionia", gender: "Female", weapon: "Spirit Mantle", range: "Ranged" },
    { name: "Karthus", region: "Shadow Isles", gender: "Male", weapon: "Staff", range: "Ranged" },
    { name: "Kassadin", region: "Void", gender: "Male", weapon: "Nether Blade", range: "Melee" },
    { name: "Katarina", region: "Noxus", gender: "Female", weapon: "Daggers", range: "Melee" },
    { name: "Kayle", region: "Targon", gender: "Female", weapon: "Fire Sword", range: "Ranged" },
    { name: "Kayn", region: "Ionia", gender: "Male", weapon: "Scythe", range: "Melee" },
    { name: "Kennen", region: "Ionia", gender: "Male", weapon: "Shuriken", range: "Ranged" },
    { name: "Kha'Zix", region: "Void", gender: "Male", weapon: "Claws", range: "Melee" },
    { name: "Kindred", region: "Runeterra", gender: "Female", weapon: "Bow", range: "Ranged" },
    { name: "Kled", region: "Noxus", gender: "Male", weapon: "Pistol/Spear", range: "Melee" },
    { name: "Kog'Maw", region: "Void", gender: "Male", weapon: "Acid/Ooze", range: "Ranged" },
    { name: "LeBlanc", region: "Noxus", gender: "Female", weapon: "Staff", range: "Ranged" },
    { name: "Lee Sin", region: "Ionia", gender: "Male", weapon: "Fists/Kicks", range: "Melee" },
    { name: "Leona", region: "Targon", gender: "Female", weapon: "Sword/Shield", range: "Melee" },
    { name: "Lillia", region: "Ionia", gender: "Female", weapon: "Staff", range: "Melee" },
    { name: "Lissandra", region: "Freljord", gender: "Female", weapon: "Ice Magic", range: "Ranged" },
    { name: "Lucian", region: "Runeterra", gender: "Male", weapon: "Light Pistols", range: "Ranged" },
    { name: "Lulu", region: "Bandle City", gender: "Female", weapon: "Staff/Pix", range: "Ranged" },
    { name: "Lux", region: "Demacia", gender: "Female", weapon: "Wand", range: "Ranged" },
    { name: "Malphite", region: "Ixtal", gender: "Male", weapon: "Rock/Body", range: "Melee" },
    { name: "Malzahar", region: "Void", gender: "Male", weapon: "Void Magic", range: "Ranged" },
    { name: "Maokai", region: "Shadow Isles", gender: "Male", weapon: "Tree Arms", range: "Melee" },
    { name: "Master Yi", region: "Ionia", gender: "Male", weapon: "Katana", range: "Melee" },
    { name: "Milio", region: "Ixtal", gender: "Male", weapon: "Fire Ball", range: "Ranged" },
    { name: "Miss Fortune", region: "Bilgewater", gender: "Female", weapon: "Twin Pistols", range: "Ranged" },
    { name: "Mordekaiser", region: "Noxus", gender: "Male", weapon: "Mace", range: "Melee" },
    { name: "Morgana", region: "Demacia", gender: "Female", weapon: "Dark Magic", range: "Ranged" },
    { name: "Naafiri", region: "Shurima", gender: "Female", weapon: "Dagger/Hounds", range: "Melee" },
    { name: "Nami", region: "Runeterra", gender: "Female", weapon: "Staff", range: "Ranged" },
    { name: "Nasus", region: "Shurima", gender: "Male", weapon: "Staff/Axe", range: "Melee" },
    { name: "Nautilus", region: "Bilgewater", gender: "Male", weapon: "Anchor", range: "Melee" },
    { name: "Neeko", region: "Ixtal", gender: "Female", weapon: "Spirit Magic", range: "Ranged" },
    { name: "Nidalee", region: "Ixtal", gender: "Female", weapon: "Spear", range: "Ranged" },
    { name: "Nilah", region: "Bilgewater", gender: "Female", weapon: "Whip", range: "Melee" },
    { name: "Nocturne", region: "Runeterra", gender: "Male", weapon: "Shadow Blades", range: "Melee" },
    { name: "Nunu & Willump", region: "Freljord", gender: "Male", weapon: "Snowballs", range: "Melee" },
    { name: "Olaf", region: "Freljord", gender: "Male", weapon: "Dual Axes", range: "Melee" },
    { name: "Orianna", region: "Piltover", gender: "Female", weapon: "The Ball", range: "Ranged" },
    { name: "Ornn", region: "Freljord", gender: "Male", weapon: "Hammer", range: "Melee" },
    { name: "Pantheon", region: "Targon", gender: "Male", weapon: "Spear/Shield", range: "Melee" },
    { name: "Poppy", region: "Demacia", gender: "Female", weapon: "Hammer", range: "Melee" },
    { name: "Pyke", region: "Bilgewater", gender: "Male", weapon: "Harpoon", range: "Melee" },
    { name: "Qiyana", region: "Ixtal", gender: "Female", weapon: "Chakram", range: "Melee" },
    { name: "Quinn", region: "Demacia", gender: "Female", weapon: "Crossbow", range: "Ranged" },
    { name: "Rakan", region: "Ionia", gender: "Male", weapon: "Feathers", range: "Melee" },
    { name: "Rammus", region: "Shurima", gender: "Male", weapon: "Spiked Shell", range: "Melee" },
    { name: "Rek'Sai", region: "Void", gender: "Female", weapon: "Claws", range: "Melee" },
    { name: "Rell", region: "Noxus", gender: "Female", weapon: "Lance", range: "Melee" },
    { name: "Renata Glasc", region: "Zaun", gender: "Female", weapon: "Chemtech Decanter", range: "Ranged" },
    { name: "Renekton", region: "Shurima", gender: "Male", weapon: "Crescent Blade", range: "Melee" },
    { name: "Rengar", region: "Ixtal", gender: "Male", weapon: "Knife", range: "Melee" },
    { name: "Riven", region: "Noxus", gender: "Female", weapon: "Broken Blade", range: "Melee" },
    { name: "Rumble", region: "Bandle City", gender: "Male", weapon: "Mech Suit", range: "Melee" },
    { name: "Ryze", region: "Runeterra", gender: "Male", weapon: "Scroll/Magic", range: "Ranged" },
    { name: "Samira", region: "Noxus", gender: "Female", weapon: "Guns/Sword", range: "Ranged" },
    { name: "Sejuani", region: "Freljord", gender: "Female", weapon: "Flail", range: "Melee" },
    { name: "Senna", region: "Shadow Isles", gender: "Female", weapon: "Relic Cannon", range: "Ranged" },
    { name: "Seraphine", region: "Piltover", gender: "Female", weapon: "Music/Voice", range: "Ranged" },
    { name: "Sett", region: "Ionia", gender: "Male", weapon: "Fists", range: "Melee" },
    { name: "Shaco", region: "Runeterra", gender: "Male", weapon: "Shivs", range: "Melee" },
    { name: "Shen", region: "Ionia", gender: "Male", weapon: "Spirit Blade", range: "Melee" },
    { name: "Shyvana", region: "Demacia", gender: "Female", weapon: "Dragon Claws", range: "Melee" },
    { name: "Singed", region: "Zaun", gender: "Male", weapon: "Poison Gas", range: "Melee" },
    { name: "Sion", region: "Noxus", gender: "Male", weapon: "Giant Axe", range: "Melee" },
    { name: "Sivir", region: "Shurima", gender: "Female", weapon: "Crossblade", range: "Ranged" },
    { name: "Skarner", region: "Ixtal", gender: "Male", weapon: "Claws/Stinger", range: "Melee" },
    { name: "Sona", region: "Demacia", gender: "Female", weapon: "Etwahl/Music", range: "Ranged" },
    { name: "Soraka", region: "Targon", gender: "Female", weapon: "Staff", range: "Ranged" },
    { name: "Swain", region: "Noxus", gender: "Male", weapon: "Demon Power", range: "Ranged" },
    { name: "Sylas", region: "Demacia", gender: "Male", weapon: "Chains", range: "Melee" },
    { name: "Syndra", region: "Ionia", gender: "Female", weapon: "Dark Orbs", range: "Ranged" },
    { name: "Tahm Kench", region: "Bilgewater", gender: "Male", weapon: "Tongue", range: "Melee" },
    { name: "Taliyah", region: "Shurima", gender: "Female", weapon: "Rock Magic", range: "Ranged" },
    { name: "Talon", region: "Noxus", gender: "Male", weapon: "Blade Cape", range: "Melee" },
    { name: "Taric", region: "Targon", gender: "Male", weapon: "Mace", range: "Melee" },
    { name: "Teemo", region: "Bandle City", gender: "Male", weapon: "Blowgun", range: "Ranged" },
    { name: "Thresh", region: "Shadow Isles", gender: "Male", weapon: "Scythe/Hook", range: "Ranged" },
    { name: "Tristana", region: "Bandle City", gender: "Female", weapon: "Cannon", range: "Ranged" },
    { name: "Trundle", region: "Freljord", gender: "Male", weapon: "Ice Club", range: "Melee" },
    { name: "Tryndamere", region: "Freljord", gender: "Male", weapon: "Greatsword", range: "Melee" },
    { name: "Twisted Fate", region: "Bilgewater", gender: "Male", weapon: "Cards", range: "Ranged" },
    { name: "Twitch", region: "Zaun", gender: "Male", weapon: "Crossbow", range: "Ranged" },
    { name: "Udyr", region: "Freljord", gender: "Male", weapon: "Animal Stances", range: "Melee" },
    { name: "Urgot", region: "Zaun", gender: "Male", weapon: "Leg Cannons", range: "Ranged" },
    { name: "Varus", region: "Ionia", gender: "Male", weapon: "Bow", range: "Ranged" },
    { name: "Vayne", region: "Demacia", gender: "Female", weapon: "Crossbows", range: "Ranged" },
    { name: "Veigar", region: "Bandle City", gender: "Male", weapon: "Staff", range: "Ranged" },
    { name: "Vel'Koz", region: "Void", gender: "Male", weapon: "Void Beams", range: "Ranged" },
    { name: "Vex", region: "Shadow Isles", gender: "Female", weapon: "Shadow", range: "Ranged" },
    { name: "Vi", region: "Piltover", gender: "Female", weapon: "Hextech Gauntlets", range: "Melee" },
    { name: "Viego", region: "Shadow Isles", gender: "Male", weapon: "Blade of the Ruined King", range: "Melee" },
    { name: "Viktor", region: "Zaun", gender: "Male", weapon: "Staff/Laser", range: "Ranged" },
    { name: "Vladimir", region: "Noxus", gender: "Male", weapon: "Blood Magic", range: "Ranged" },
    { name: "Volibear", region: "Freljord", gender: "Male", weapon: "Lightning/Claws", range: "Melee" },
    { name: "Warwick", region: "Zaun", gender: "Male", weapon: "Claws", range: "Melee" },
    { name: "Wukong", region: "Ionia", gender: "Male", weapon: "Staff", range: "Melee" },
    { name: "Xayah", region: "Ionia", gender: "Female", weapon: "Feathers", range: "Ranged" },
    { name: "Xerath", region: "Shurima", gender: "Male", weapon: "Arcane Energy", range: "Ranged" },
    { name: "Xin Zhao", region: "Demacia", gender: "Male", weapon: "Spear", range: "Melee" },
    { name: "Yasuo", region: "Ionia", gender: "Male", weapon: "Katana", range: "Melee" },
    { name: "Yone", region: "Ionia", gender: "Male", weapon: "Dual Swords", range: "Melee" },
    { name: "Yorick", region: "Shadow Isles", gender: "Male", weapon: "Shovel", range: "Melee" },
    { name: "Yuumi", region: "Bandle City", gender: "Female", weapon: "Book/Magic", range: "Ranged" },
    { name: "Zac", region: "Zaun", gender: "Male", weapon: "Slime Body", range: "Melee" },
    { name: "Zed", region: "Ionia", gender: "Male", weapon: "Shadow Blades", range: "Melee" },
    { name: "Zeri", region: "Zaun", gender: "Female", weapon: "Electric Gun", range: "Ranged" },
    { name: "Ziggs", region: "Zaun", gender: "Male", weapon: "Bombs", range: "Ranged" },
    { name: "Zilean", region: "Runeterra", gender: "Male", weapon: "Time Magic", range: "Ranged" },
    { name: "Zoe", region: "Targon", gender: "Female", weapon: "Star Dust", range: "Ranged" },
    { name: "Zyra", region: "Ixtal", gender: "Female", weapon: "Plant Thorns", range: "Ranged" }
];

// UI Helper for Chat
function addChatMessage(name, message) {
    const chatBox = document.getElementById("chat-box");
    if (chatBox) {
        chatBox.innerHTML += `<div><strong>${name}:</strong> ${message}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    }
}

async function init() {
    try {
        // Reduced configuration to ensure faster loading
        await insertCoin(); 
        
        // Listen for chat messages
        onChatMessage((message, sender) => {
            addChatMessage(sender.getProfile().name, message);
        });

        if (isHost()) {
            setupNewRound();
        }
        
        loop();
    } catch (err) {
        console.error("Playroom failed to load:", err);
        document.getElementById("status").innerText = "Connection Error. Please Refresh.";
    }
}

function setupNewRound() {
    const champ = CHAMPION_POOL[Math.floor(Math.random() * CHAMPION_POOL.length)];
    const players = getPlayers();
    const impostor = players[Math.floor(Math.random() * players.length)];
    
    setState("targetChamp", champ, true);
    setState("impostorId", impostor.id, true);
    setState("gamePhase", "LOBBY", true);
}

function loop() {
    const phase = getState("gamePhase");
    const content = document.getElementById("content");
    const status = document.getElementById("status");

    if (phase === "LOBBY") {
        status.innerText = "Lobby";
        content.innerHTML = isHost() ? 
            `<button onclick="setState('gamePhase', 'ROLE_REVEAL', true)">START GAME</button>
             <button onclick="setupNewRound()">RE-ROLL CHAMPION</button>` : 
            "<p>Waiting for host to start...</p>";
    }

    if (phase === "ROLE_REVEAL") {
        const isImpostor = myPlayer().id === getState("impostorId");
        const champ = getState("targetChamp");
        status.innerText = isImpostor ? "YOU ARE THE IMPOSTOR" : "YOU ARE CREW";
        content.innerHTML = isImpostor ? 
            `<div class="role-box">HINTS:<br>Region: ${champ.region}<br>Gender: ${champ.gender}<br>Weapon: ${champ.weapon}</div>` :
            `<img src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/champion/${champ.name}.png"><h2>${champ.name}</h2>`;
        
        if(isHost()){
            // Automatically move to turns after 10 seconds
            setTimeout(() => { 
                if(getState("gamePhase") === "ROLE_REVEAL") startTurns(); 
            }, 10000);
        }
    }

    // ... (Keep the rest of your TALKING, VOTING, and RESULTS logic)

    requestAnimationFrame(loop);
}

// Function for Chat Input
function sendChat() {
    const input = document.getElementById("chat-input");
    if (input.value.trim() !== "") {
        Playroom.RPC.call("send-msg", input.value, Playroom.RPC.Mode.ALL);
        input.value = "";
    }
}

init();
</script>
</body>
</html>
